{extends file="layout.html"}
{block name=title}::: LMS :{$layout.pagetitle|striphtml} :::{/block}
{block name=module_content}
    <!--// $Id$ //-->
    {$xajax}
    {include file="calendar_js.html"}
    <SCRIPT type="text/javascript">
        <!--
            function SetEndtime()
        {
            box = document.forms['event'].elements['event[begintime]'];
            document.forms['event'].elements['event[endtime]'].value = box.options[box.selectedIndex].value;
        }

        function CheckEndtime()
        {
            start = document.forms['event'].elements['event[begintime]'];
            end = document.forms['event'].elements['event[endtime]'];
            if (Number(start.options[start.selectedIndex].value) > Number(end.options[end.selectedIndex].value))
            {
                alert('{trans("End time must not precede start time!")}');
                end.value = start.options[start.selectedIndex].value;
            }
        }

        function change_customer(elem) {
            xajax_select_customer(elem.value);
        }

        function update_nodes_location(data)
        {
            var i, len;
            var nodes_location_select = document.getElementById('nodes_location_sel');
            nodes_location_select.options.length = 0;
            for (i = 0, len = data.length; i < len; i++) {
                nodes_location_select.options[nodes_location_select.options.length] = new Option(data[i].name + ": " + data[i].location, data[i].id);
            }
        }
        //-->
    </SCRIPT>
    <H1>{$layout.pagetitle}</H1>

    <FORM class="form-inline" method="POST" action="?m=eventadd" name="event" id="event">
        <INPUT type="submit" class="hiddenbtn">

        <div class="card">
            <div class="card-block">
                <div class="form-group">
                    <label for="title">{trans("Title")}:</label>
                    <input type="text" class="form-control form-control-sm" id="title" name="event[title]" id="event[title]" value="{$event.title}" required palceholder="{trans('Enter event title')}">

                    <label for="title">{trans("Type")}:</label>
                    <SELECT class="form-control form-control-sm" name="event[type]">
                        {foreach from=$_EVENTTYPES key=key item=type}
                            <OPTION value="{$key}" {if $key == $event.type || (!$event.type && $key == $smarty.const.EVENT_OTHER)}SELECTED{/if}>{$type}</OPTION>
                            {/foreach}
                    </SELECT>

                    <label for="event_status">{trans("Status private")}:</label>
                    <INPUT class="form-control form-control-sm" type="checkbox" name="event[status]" id="event_status" value="1" {tip text="Select event's status"}{if $event.status}CHECKED{/if}>
                </div>

                <hr>

                <div class="form-group">
                    <label>{trans("Begin")}:</label>
                    <div class="input-group">                    
                        <INPUT class="form-control form-control-sm datepicker_default" type="text" placeholder="{trans("yyyy/mm/dd")}" name="event[date]" value="{$event.date}" {tip class="calendar" text="Enter date in YYYY/MM/DD format (empty field means today) or click to choose it from calendar" trigger="date"}>
                        <span class="input-group-addon"><i class="fa fa-calendar fa-fw fa"></i></span>
                    </div>
                    <SELECT class="form-control form-control-sm" name="event[begintime]" {tip text="Select time of"} OnChange="javascript:SetEndtime();">
                        {section name=time loop=$hours}
                            <OPTION value="{$hours[time]}" {if $hours[time] == $event.begintime}SELECTED{/if}>{math equation="floor(x/100)" x=$hours[time] format="%02d"}:{math equation="x % 100" x=$hours[time] format="%02d"}</OPTION>
                            {/section}
                    </SELECT>
                </div>

                <div class="form-group">
                    <lable>{trans("End")}:</label>
                        <div class="input-group">
                            <INPUT class="form-control form-control-sm datepicker_default" type="text" placeholder="{trans("yyyy/mm/dd")}" name="event[enddate]" value="{$event.enddate}" size="12" {tip class="calendar" text="Enter date in YYYY/MM/DD format (empty field means today) or click to choose it from calendar" trigger="enddate"}>
                            <span class="input-group-addon"><i class="fa fa-calendar fa-fw fa"></i></span>
                        </div>
                        <SELECT class="form-control form-control-sm" name="event[endtime]" {tip text="Select time of"} OnChange="javascript:CheckEndtime();">
                            {section name=time loop=$hours}
                                <OPTION value="{$hours[time]}" {if $hours[time] == $event.endtime}SELECTED{/if}>{math equation="floor(x/100)" x=$hours[time] format="%02d"}:{math equation="x % 100" x=$hours[time] format="%02d"}</OPTION>
                                {/section}
                        </SELECT>
                </div>

                <hr>

                <div class="form-group">
                    {trans("Description")}:
                    <TEXTAREA class="form-control form-control-sm" name="event[description]" cols="50" rows="5" placeholder="{trans('Enter additional information (optional)')}">{$event.description}</TEXTAREA>
                </div>

                <hr>

                <div class="form-group">
                    <label for="customer">{trans("Customer")}:</label>
                    {customerlist form="event" class="form-control form-control-sm" customers=$customerlist selected=$event.customerid selectname="event[customerid]" inputname="event[custid]" customOnChange="change_customer(this);"}

                    <label>{trans("Node")}:</label>
		    <select class="form-control form-control-sm" id="nodes_location_sel" name="event[nodeid]" {tip text="Select node location"}>
                        {foreach from=$nodes_location item=item}
			    <option value="{$item.id}"{if $item.id == $data.nodeid} selected{/if}>{$item.location}</option>
                        {/foreach}
		    </select>

		    <label>{trans("Use customer location:")}</label>
                    <input class="form-control form-control-sm" type="checkbox" name="event[customer_location]">
                </div>

                    <hr>

                    <div class="form-group">
                        <label for="userid">{trans("Users")}:</label>
                        <SELECT class="form-control form-control-sm" name="event[userlist][]" id="userid" multiple>
                        {foreach $userlist as $user}
                                <OPTION value="{$user.id}"{if in_array($user.id, $event.userlist)} selected{/if}>{$user.name}</OPTION>
                            {/foreach}
                        </SELECT>

                        <label class="btn btn-sm btn-secondary" for="usergroup_0">
                        {trans("All users")}:
                            <input class="form-control form-control-sm" type="radio" name="event[usergroup]" id="usergroup_0" value="0" onChange="xajax_getUsersForGroup(0)"{if empty($event.usergroup)} checked{/if}>
                        </label>

                    {foreach $usergroups as $group}
                            <label class="btn btn-sm btn-secondary">{$group.name}:
                                <input class="form-control form-control-sm" type="radio" name="event[usergroup]" id="usergroup_{$group.id}" value="{$group.id}" onClick="xajax_getUsersForGroup({$group.id})"{if $event.usergroup == $group.id} checked{/if}>

                            </label>
                    {/foreach}
                    </div>

                    <hr>

                    <div class="form-group">
                        <A class="btn btn-danger" href="javascript:document.event.submit();" accesskey="s">{trans("Submit")}</A>
                        <A class="btn btn-secondary" href="?m=eventlist">{trans("Cancel")}</A>
                        <INPUT class="form-control form-control-sm" type="checkbox" name="event[reuse]" id="reuse" value="ON" {if $event.reuse}checked{/if}> <label for="reuse">{trans("Display this form again, when this event is saved")}</label>
                    </div>
            </div>
        </div>
</form>

<SCRIPT type="text/javascript">
        <!--
                            document.forms['event'].elements['event[title]'].focus();
    var userms = new multiselect('event', 'userid', '{trans("- select user -")}');

        function update_user_selection(users) {
        {if ConfigHelper::getConfig('phpui.event_usergroup_selection_type', 'update') == 'update'}
            userms.updateSelection(users);
        {else}
            userms.filterSelection(users);
        {/if}
        }
        //-->
                    </SCRIPT>
{/block}
