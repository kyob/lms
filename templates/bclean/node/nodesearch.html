{extends file="layout.html"}
{block name=title}::: LMS :{$layout.pagetitle|striphtml} :::{/block}
{block name=module_content}
    {$xajax}
    <SCRIPT type="text/javascript">
        <!--
            function PrintList()
        {
            document.nodesearch.action = "?m=nodesearch&search=1&print=1";
            document.nodesearch.target = "_BLANK";
            document.nodesearch.submit();
        }

        function Search()
        {
            document.nodesearch.action = "?m=nodesearch&search=1";
            document.nodesearch.target = "";
            document.nodesearch.submit();
        }
        //-->
    </SCRIPT>
    <H1>{$layout.pagetitle}</H1>
    <FORM class="from-inline" method="post" action="?m=nodesearch&amp;search" name="nodesearch">
        <INPUT type="submit" class="hiddenbtn">
        <INPUT TYPE="hidden" NAME="m" VALUE="nodesearch">
        <table class="table table-sm table-striped table-bordered table-hover">
            <thead class="thead-inverse">
                <TR>
                    <TD colspan="2" class="bold">
                        {trans("Find nodes matching the following search criteria:")}
                    </TD>
                </TR>
            </THEAD>
            <TBODY>
                <TR>
                    <TD>
                        {trans("Node name:")}
                    </TD>
                    <TD>
                        <INPUT class="from-control" TYPE="text" NAME="search[name]" {tip text="Enter node name or it's fragment"}>
                    </TD>
                </TR>
                <TR>
                    <TD>
                        {trans("MAC address:")}
                    </TD>
                    <TD>
                        <INPUT class="from-control" TYPE="text" NAME="search[mac]" {tip text="Enter MAC address or it's fragment"}>
                    </TD>
                </TR>
                <TR>
                    <TD>
                        {trans("IP address:")}
                    </TD>
                    <TD>
                        <INPUT class="from-control" TYPE="text" NAME="search[ipaddr]" {tip text="Enter IP address or it's fragment"}>
                    </TD>
                </TR>
                <TR>
                    <TD>
                        {trans("Location:")}
                    </TD>
                    <TD>
                        <INPUT class="from-control" TYPE="text" NAME="search[location]" {tip text="Enter node location"}>
                    </TD>
                </TR>
                {if !empty($states)}
                    <tr id="state">
                        <td>
                            {trans("State")}:
                        </td>
                        <td>
                            <select class="from-control" id="state_sel" name="search[state]" onchange="change_selection(this)" {tip text="Select state"}>
                                <option value="0"></option>
                                {foreach from=$states item=item}
                                    <option value="{$item.id}"{if $item.id == $data.stateid} selected{/if}>{$item.name}</option>
                                {/foreach}
                            </select>
                        </td>
                    </tr>
                    <tr id="district"{if empty($districts)} style="display: none;"{/if}>
                        <td>
                            {trans("District")}:
                        </td>
                        <td>
                            <select class="from-control" id="district_sel" name="search[district]" onchange="change_selection(this)" {tip text="Select district"}>
                                {if !$data.districtid}
                                    <option value="0"></option>
                                {/if}
                                {foreach from=$districts item=item}
                                    <option value="{$item.id}"{if $item.id == $data.districtid} selected{/if}>{$item.name}</option>
                                {/foreach}
                            </select>
                        </td>
                    </tr>
                    <tr id="borough"{if empty($boroughs)} style="display: none;"{/if}>
                        <td>
                            {trans("Commune")}:
                        </td>
                        <td>
                            <select class="from-control" id="borough_sel" name="search[borough]" {tip text="Select commune"}>
                                {if !$data.boroughid}
                                    <option value="0"></option>
                                {/if}
                                {foreach from=$boroughs item=item}
                                    <option value="{$item.id}"{if $item.id == $data.boroughid} selected{/if}>{$item.name}</option>
                                {/foreach}
                            </select>
                        </td>
                    </tr>
                {/if}
                <TR>
                    <TD>
                        {trans("Description:")}
                    </TD>
                    <TD>
                        <INPUT class="from-control" TYPE="text" NAME="search[info]" {tip text="Enter additional information"}>
                    </TD>
                </TR>
                <TR>
                    <TD>
                        {trans("Qualification operator:")}
                    </TD>
                    <TD>
                        <INPUT class="from-control" type="radio" id="operator0" value="AND" name="k"{if $k!='OR'} checked{/if}><label for="operator0">{trans("and")}</label>
                        <INPUT class="from-control" type="radio" id="operator1" value="OR" name="k"{if $k=='OR'} checked{/if}><label for="operator1">{trans("or")}</label>
                    </TD>
                </TR>
                <TR>
                    <TD colspan="2">
                        <A class="btn btn-sm btn-primary" href="javascript:Search()" accesskey="s">{trans("Search")}</A>
                        <A class="btn btn-sm btn-secondary" href="javascript:PrintList()">{trans("Print")}</A>
                    </TD>
                </TR>
            </TBODY>
        </TABLE>
    </FORM>
    <SCRIPT type="text/javascript">
        <!--
    function change_selection(elem)
        {
            var district = document.getElementById('district'),
                    borough = document.getElementById('borough');

            if (elem.name == 'search[state]') {
                district.style.display = 'none';
                borough.style.display = 'none';
            } else if (elem.name == 'search[district]')
                borough.style.display = 'none';

            if (elem.value != 0)
                xajax_select_location(elem.name, elem.value);
        }

        function update_selection(type, data, selected)
        {
            var i, len, elem = document.getElementById(type),
                    select = document.getElementById(type + '_sel');

            select.options.length = 0;
            select.options[0] = new Option('', 0);
            for (i = 0, len = data.length; i < len; i++) {
                select.options[select.options.length] = new Option(data[i].name, data[i].id);
            }

            if (i > 0)
                elem.style.display = '';
            select.value = selected ? selected : 0;
            select.focus();
        }

        document.forms['nodesearch'].elements['search[name]'].focus();
        //-->
    </SCRIPT>
{/block}
