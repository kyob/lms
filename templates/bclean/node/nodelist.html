{extends file="layout.html"}
{block name=title}::: LMS :{$layout.pagetitle|striphtml} :::{/block}

{block name=module_content}
    <!--// $Id$ //-->
    <H1>{$layout.pagetitle}</H1>
        {$lastonline_limit = ConfigHelper::getConfig('phpui.lastonline_limit')}
    <FORM method="get" action="?m={$layout.module}" name="choosefilter">

        <INPUT type="submit" class="hiddenbtn">
        <INPUT type="hidden" NAME="m" VALUE="nodelist">
        <INPUT type="hidden" NAME="page" id="page" VALUE="1">


        {trans("Status:")}
        <SELECT NAME="s" ONCHANGE="document.choosefilter.submit();">
            <OPTION VALUE="0"{if $listdata.state == 0} SELECTED{/if}>{trans("- all -")}</OPTION>
            <OPTION VALUE="1"{if $listdata.state == 1} SELECTED{/if}>{trans("connected<!plural:item>")}</OPTION>
            <OPTION VALUE="2"{if $listdata.state == 2} SELECTED{/if}>{trans("disconnected<!plural:item>")}</OPTION>
            <OPTION VALUE="3"{if $listdata.state == 3} SELECTED{/if}>{trans("online")}</OPTION>
            <OPTION VALUE="4"{if $listdata.state == 4} SELECTED{/if}>{trans("without tariff")}</OPTION>
            <OPTION VALUE="5"{if $listdata.state == 5} SELECTED{/if}>{trans("TERRIT not specified")}</OPTION>
            <OPTION VALUE="6"{if $listdata.state == 6} SELECTED{/if}>{trans("Net Device not specified")}</OPTION>
        </SELECT>
        &nbsp;
        {trans("Network:")}
        <SELECT NAME="n" ONCHANGE="document.choosefilter.submit();">
            <OPTION value="0" {if !$listdata.network} SELECTED {/if}>{trans("- all networks -")}</OPTION>
                {section name=networks loop=$networks}
                <OPTION value="{$networks[networks].id}" {if $listdata.network == $networks[networks].id} SELECTED {/if}>{$networks[networks].name|truncate:30:"...":true}</OPTION>
                {/section}
        </SELECT>
        &nbsp;
        {trans("Group:")}
        <SELECT NAME="ng" ONCHANGE="document.choosefilter.submit();">
            <OPTION value="" {if !$listdata.nodegroup} SELECTED {/if}>{trans("- all groups -")}</OPTION>
                {foreach from=$nodegroups item=nodegroup}
                <OPTION value="{$nodegroup.id}" {if $listdata.nodegroup == $nodegroup.id} SELECTED {/if}>{$nodegroup.name|truncate:30:"...":true}</OPTION>
                {/foreach}
        </SELECT>
        &nbsp;
        {trans("Customers Group:")}
        <SELECT NAME="g" ONCHANGE="document.choosefilter.submit();">
            <OPTION value="" {if !$listdata.customergroup} SELECTED {/if}>{trans("- all groups -")}</OPTION>
                {section name=customergroups loop=$customergroups}
                <OPTION value="{$customergroups[customergroups].id}" {if $listdata.customergroup == $customergroups[customergroups].id} SELECTED {/if}>{$customergroups[customergroups].name|truncate:30:"...":true}</OPTION>
                {/section}
        </SELECT>
        &nbsp;
        {trans("Project:")}
        <SELECT NAME="p" ONCHANGE="document.choosefilter.submit();">
            <OPTION VALUE="-1"{if $listdata.invprojectid == -1} selected{/if}>- {trans("all")} -</OPTION>
            <OPTION VALUE="-2"{if $listdata.invprojectid == -2} selected{/if}>- {trans("without project")} -</OPTION>
                {foreach $NNprojects as $project}
                <OPTION VALUE="{$project.id}"{if $listdata.invprojectid == $project.id} selected{/if}>{$project.name}</OPTION>
                {/foreach}
        </SELECT>

    </FORM>

    {if $pagination->getTotal() != 0}
        {include file="pagination.html"}
    {/if}

    <TABLE class="table table-sm table-striped table-bordered table-hover">
        {block name="nodelist-list-header"}
            <thead class="thead-inverse">

                <TR>
                    <th>&nbsp;</th>
                    <th >
                        <A href="?m=nodelist&amp;o=name{if $listdata.direction == "asc" && $listdata.order == "name"},desc{/if}">{trans("Name")}</A>{if $listdata.order == "name"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                        /
                        <A href="?m=nodelist&amp;o=id{if $listdata.direction == "asc" && $listdata.order == "id"},desc{/if}">{trans("Node ID")}</A>{if $listdata.order == "id"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                        /
                        <A href="?m=nodelist&amp;o=location{if $listdata.direction == "asc" && $listdata.order == "location"},desc{/if}">{trans("Location")}</A>{if $listdata.order == "location"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                    </th>
                    <th>
                        {trans("Network:")}
                    </th>
                    <th>
                        <A href="?m=nodelist&amp;o=ip{if $listdata.direction == "asc" && $listdata.order == "ip"},desc{/if}">{trans("IP address")}</A>{if $listdata.order == "ip"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                    </th>
                    <th>
                        <A href="?m=nodelist&amp;o=ip_pub{if $listdata.direction == "asc" && $listdata.order == "ip_pub"},desc{/if}">{trans("Pub. IP address")}</A>{if $listdata.order == "ip_pub"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                    </th>
                    <th>
                        <A href="?m=nodelist&amp;o=mac{if $listdata.direction == "asc" && $listdata.order == "mac"},desc{/if}">{trans("MAC address")}</A>{if $listdata.order == "mac"}<i class="fa fa-sort-{if $listdata.direction == "desc"}asc{else}desc{/if}" aria-hidden="true"></i>{/if}
                    </th>
                    <th>
                        {t a=$pagination->getTotal()}Total: $a{/t}
                    </th>
                </TR>
            </thead>
        {/block}

        {block name="nodelist-list-body"}
            {section name=nodelist loop=$nodelist}
                <TR{if ! $nodelist[nodelist].access} class="text-muted"{/if}>
                    <TD>
                        {if $nodelist[nodelist].lastonline}
                            {if ($smarty.now-$nodelist[nodelist].lastonline) > $lastonline_limit}
                                <i class="fa fa-desktop fa-lg fa-fw danger" aria-hidden="true" title="{trans("Offline")}"></i>
                            {else}
                                <i class="fa fa-desktop fa-lg fa-fw success" aria-hidden="true" title="{trans("Online")}"></i>
                            {/if}
                        {else}
                            <i class="fa fa-desktop fa-lg fa-fw muted" aria-hidden="true" title="{trans("Unknown")}"></i>
                        {/if}
                        {if $nodelist[nodelist].info}
                            <i class="fa fa-info-circle fa-lg fa-fw primary" aria-hidden="true" {tip text=$nodelist[nodelist].info}></i>
                        {/if}
                    </TD>
                    <TD onClick="return self.location.href = '?m=nodeinfo&amp;id={$nodelist[nodelist].id}';">
                        <span class="bold"><A name="{$nodelist[nodelist].id}">{$nodelist[nodelist].name}</A></span> <span class="blend">({$nodelist[nodelist].id|string_format:"%04d"})</span>
                        <br>
                        {$nodelist[nodelist].location}{if $nodelist[nodelist].borough_name}<span class="blend">({$nodelist[nodelist].state_name} / {$nodelist[nodelist].district_name} / {$_BOROUGHTYPES[$nodelist[nodelist].borough_type]} {$nodelist[nodelist].borough_name})</span>{/if}
                    </TD>
                    <TD onClick="return self.location.href = '?m=nodeinfo&amp;id={$nodelist[nodelist].id}';">
                        {$nodelist[nodelist].netname}
                    </TD>
                    <TD onClick="return self.location.href = '?m=nodeinfo&amp;id={$nodelist[nodelist].id}';">
                        {$nodelist[nodelist].ip}
                    </TD>
                    <TD onClick="return self.location.href = '?m=nodeinfo&amp;id={$nodelist[nodelist].id}';">
                    {if $nodelist[nodelist].ip_pub != "0.0.0.0"}{$nodelist[nodelist].ip_pub}{/if}
                </TD>
                <TD onClick="return self.location.href = '?m=nodeinfo&amp;id={$nodelist[nodelist].id}';">
                    {$nodelist[nodelist].mac|replace:",":"</SPAN><BR><SPAN class=\"nobr\"><img src=\"img/mac.gif\" alt=\"\"> "}
                </TD>
                <TD>
                    <div class="btn-group" role="group" aria-label="Basic example">
                        <a type="button" class="btn btn-sm btn-{if ! $nodelist[nodelist].access}secondary{else}success{/if}" href="?m=nodeset&amp;id={$nodelist[nodelist].id}">
                            <i class="fa fa-toggle-on fa-fw" aria-hidden="true"></i>
                            {if ! $nodelist[nodelist].access}
                                {trans("Connect")}
                            {else}
                                {trans("Disconnect")}
                            {/if}
                        </A>

                        <a type="button" class="btn btn-sm btn-{if ! $nodelist[nodelist].warning}secondary{else}warning{/if}" href="?m=nodewarn&amp;id={$nodelist[nodelist].id}">
                            <i class="fa fa-exclamation-triangle fa-fw warning" aria-hidden="true"></i>
                            {if ! $nodelist[nodelist].warning}
                                {trans("Enable notice")}
                            {else}
                                {trans("Disable notice")}
                            {/if}
                        </A>

                        <a type="button" class="btn btn-sm btn-danger" onClick="return confirmLink(this, '{t a=$nodelist[nodelist].name}Are you sure, you want to remove node \'$a\' from database?{/t}')" href="?m=nodedel&amp;id={$nodelist[nodelist].id}">
                            <i class="fa fa-trash fa-fw danger" aria-hidden="true"></i>{trans("Delete")}
                        </A>

                        <a type="button" class="btn btn-sm btn-primary" href="?m=nodeedit&amp;id={$nodelist[nodelist].id}">
                            <i class="fa fa-pencil-square fa-fw primary" aria-hidden="true"></i>{trans("Edit")}
                        </a>
                    </div>


                </TD>
            </TR>
        {sectionelse}
            <TR>
                <TD colspan="5" class="empty-table">
                    <p>{trans("No such nodes in database.")}</p>
                </TD>
            </TR>
        {/section}
    {/block}
</TABLE>

{if $pagination->getTotal() != 0}
    {include file="pagination.html"}
{/if}



{block name="nodelist-list-footer"}
    {trans("Total:")}<BR>
    {trans("Connected<!nodes>:")}<BR>
    {trans("Disconnected:")}

{if $listdata.total}{$listdata.total}{else}0{/if}<BR>
{if $listdata.totalon}{$listdata.totalon}{else}0{/if}<BR>
{if $listdata.totaloff}{$listdata.totaloff}{else}0{/if}
{/block}


{/block}
